<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="STICKS">
<meta name="theme-color" content="#09090b">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>STICKS</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<!-- Google Maps loaded dynamically -->
<!-- Maps replaced with custom SVG hole illustrations -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
html,body,#root{height:100%;width:100%;overflow:hidden;}
body{font-family:'Outfit',sans-serif;background:#09090b;overscroll-behavior:none;}
::-webkit-scrollbar{display:none;}
input,select,button{font-family:'Outfit',sans-serif;-webkit-appearance:none;}
input::placeholder{color:#3f3f46;}
select{color:#e4e4e7;}
select option{background:#111114;color:#e4e4e7;}
canvas{image-rendering:auto;}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes pulse{0%,100%{opacity:0.4}50%{opacity:0.8}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useCallback,useMemo,useRef}=React;

// Supabase client
const SUPABASE_URL="https://adcybagoehsbsljxbtgu.supabase.co";
const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkY3liYWdvZWhzYnNsanhidGd1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4ODUyNzQsImV4cCI6MjA4NzQ2MTI3NH0.m2NaL-ZXhA4c3jkZrTlZJ2BgyVr7OWsYw6M3lUVxqOc";
const sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON);

const CLUBS=["Driver","3W","5W","7W","2i","3i","4i","5i","6i","7i","8i","9i","PW","GW","SW","LW","Putter"];
const AVATARS=["#34d399","#60a5fa","#f59e0b","#f87171","#a78bfa","#fb923c","#ec4899","#14b8a6","#e879f9","#84cc16"];
// Map rendering uses custom SVG illustrations
const COURSES=[
{id:"goat_hill",name:"Goat Hill Park",loc:"Oceanside, CA",par:65,holes:18,greens:[{lat:33.19762,lng:-117.35778},{lat:33.19838,lng:-117.35712},{lat:33.19772,lng:-117.35598},{lat:33.19672,lng:-117.35528},{lat:33.19618,lng:-117.35598},{lat:33.19568,lng:-117.35702},{lat:33.19515,lng:-117.35798},{lat:33.19432,lng:-117.35868},{lat:33.19498,lng:-117.35948},{lat:33.19588,lng:-117.36028},{lat:33.19658,lng:-117.36108},{lat:33.19738,lng:-117.36038},{lat:33.19812,lng:-117.36108},{lat:33.19868,lng:-117.36002},{lat:33.19782,lng:-117.35852},{lat:33.19688,lng:-117.35758},{lat:33.19618,lng:-117.35838},{lat:33.19702,lng:-117.35912}],teeBoxes:[{lat:33.19830,lng:-117.35862},{lat:33.19775,lng:-117.35788},{lat:33.19845,lng:-117.35725},{lat:33.19788,lng:-117.35608},{lat:33.19678,lng:-117.35538},{lat:33.19622,lng:-117.35608},{lat:33.19572,lng:-117.35712},{lat:33.19525,lng:-117.35808},{lat:33.19442,lng:-117.35878},{lat:33.19505,lng:-117.35958},{lat:33.19598,lng:-117.36038},{lat:33.19668,lng:-117.36118},{lat:33.19745,lng:-117.36048},{lat:33.19818,lng:-117.36118},{lat:33.19875,lng:-117.36012},{lat:33.19792,lng:-117.35862},{lat:33.19695,lng:-117.35768},{lat:33.19628,lng:-117.35848}],tees:{black:{r:64.2,s:107,y:[290,182,289,328,145,179,162,328,135,305,175,329,175,285,451,346,178,300]},white:{r:62.5,s:103,y:[275,169,289,300,135,165,150,310,119,279,160,308,167,271,443,319,153,288]},green:{r:60.0,s:97,y:[261,146,200,279,118,138,113,284,97,256,126,249,157,213,410,306,116,266]}},pars:[4,3,4,4,3,3,3,4,3,4,3,4,3,4,5,4,3,4],tips:["Slight dogleg right. Aim straight off the tee, 200yd leaves ~100 to the hole.","Plays uphill into wind. Take an extra club.","Aim at the big dead tree with slight draw. Hole on left side of double green.","Long drive can get you in trouble. 200-210 off the tee is plenty.","Generous fairway, left center is best angle to green.","Favor left side. Check pin placements on 6 and 14, enjoy the ocean view.","Aim over the aiming post. Make sure group ahead is on the green.","Shared green \u2014 aim at the pin on the right.","Shortest hole, plays slightly downhill. Finish the front strong.","Downhill. Avoid bunkers on left, aim left center as ball kicks right.","Plays uphill, usually into wind. Bring your 220yd club for hole 12 tee.","Dogleg left. 225 to the aiming post. Second shot uphill to small two-tiered green.","Not long but keep it straight. Plays uphill.","Dogleg right, keep drive left of Eucalyptus trees. Bunker in front of green.","Slightly blind downhill tee shot. Dead straight \u2014 keep it between the tree lines.","Downhill, usually helping wind. Favor left side of green.","Ball below the hole for an uphill putt is an advantage.","Straight away. 200-220 off the tee leaves ~100. Finish strong."]},
{id:"encinitas_ranch",name:"Encinitas Ranch",loc:"Encinitas, CA",par:72,holes:18,greens:[{lat:33.0678,lng:-117.1575},{lat:33.0672,lng:-117.1562},{lat:33.0660,lng:-117.1548},{lat:33.0650,lng:-117.1565},{lat:33.0642,lng:-117.1582},{lat:33.0652,lng:-117.1598},{lat:33.0665,lng:-117.1610},{lat:33.0680,lng:-117.1618},{lat:33.0692,lng:-117.1602},{lat:33.0700,lng:-117.1585},{lat:33.0712,lng:-117.1568},{lat:33.0705,lng:-117.1552},{lat:33.0695,lng:-117.1538},{lat:33.0682,lng:-117.1525},{lat:33.0670,lng:-117.1540},{lat:33.0660,lng:-117.1558},{lat:33.0672,lng:-117.1572},{lat:33.0685,lng:-117.1588}],tees:{blue:{r:71.0,s:126,y:[347,192,527,342,354,160,365,407,497,442,540,169,398,433,373,361,185,495]},green:{r:69.3,s:122,y:[347,168,527,342,300,160,336,330,497,407,540,169,370,375,373,324,160,495]},white:{r:67.5,s:117,y:[297,168,522,285,300,139,336,330,470,407,487,130,370,375,320,324,160,470]},gold:{r:64.5,s:110,y:[275,122,495,245,250,120,315,290,430,357,440,110,333,347,255,282,130,439]}},pars:[4,3,5,4,4,3,4,4,5,4,5,3,4,4,4,4,3,5],tips:["Forgiving opener. Wide fairway, avoid the right bunker. Mid-iron approach.","All carry over a canyon. Club up if wind is in your face.","Reachable in two for long hitters. Layup to 100 leaves a wedge in.","Dogleg left. Aim right-center off the tee. Green slopes back to front.","Elevated tee with ocean views. Favor the left side of the fairway.","Short par 3 but don't be short \u2014 bunkers guard the front.","Tight driving hole. Keep it in play, the green is well-bunkered.","Longest par 4 on the front. Two solid shots to reach this elevated green.","Risk-reward par 5. Lay up short of the cross bunkers or go for it.","Tough opener to the back nine. Dogleg right, big hitters can cut the corner.","Longest hole on the course. Three good shots to get home.","Downhill par 3. Take less club than you think, green runs away from you.","Narrow fairway with canyon left. Play to the right side off the tee.","Long par 4 with elevation change. Driver to the flat spot, then mid-iron in.","Scenic hole along the bluffs. Stay left off the tee, green is wide but shallow.","Back-to-front slope on the green. Below the hole is key here.","Over a canyon to a well-guarded green. Check the pin position before choosing club.","Great finishing par 5. Reachable in two but water guards the green. Solid layup works."]},
{id:"sandpiper",name:"Sandpiper Golf Club",loc:"Santa Barbara, CA",par:72,holes:18,greens:[{lat:34.4415,lng:-119.8825},{lat:34.4428,lng:-119.8810},{lat:34.4440,lng:-119.8795},{lat:34.4450,lng:-119.8812},{lat:34.4438,lng:-119.8830},{lat:34.4425,lng:-119.8845},{lat:34.4412,lng:-119.8858},{lat:34.4400,lng:-119.8842},{lat:34.4390,lng:-119.8825},{lat:34.4378,lng:-119.8808},{lat:34.4370,lng:-119.8792},{lat:34.4382,lng:-119.8778},{lat:34.4395,lng:-119.8762},{lat:34.4408,lng:-119.8748},{lat:34.4420,lng:-119.8735},{lat:34.4432,lng:-119.8752},{lat:34.4445,lng:-119.8768},{lat:34.4435,lng:-119.8785}],tees:{black:{r:75.0,s:135,y:[530,471,430,258,513,195,394,399,420,390,228,347,532,445,602,395,429,181]},gold:{r:72.6,s:130,y:[511,447,407,226,495,173,368,370,401,345,202,325,455,425,582,373,374,167]},silver:{r:70.3,s:126,y:[495,402,387,196,483,155,357,362,393,321,172,306,405,385,540,348,353,136]},copper:{r:67.6,s:120,y:[454,376,353,165,430,125,333,350,368,315,148,252,392,330,471,337,304,99]}},pars:[5,4,4,3,5,3,4,4,4,4,3,4,5,4,5,4,4,3],tips:["Opens with a reachable par 5. Two good shots set up an easy wedge. Don't miss left.","Hardest hole on the course. Long uphill par 4 \u2014 two of your best to reach this green.","Slight dogleg right. Mid-iron approach to a well-bunkered green. Miss right is dead.","Downhill par 3 with ocean views behind you. Take one less club, wind usually helps.","Par 5 with a narrow landing area. Lay up short of the fairway bunkers for a clean look.","Short par 3 but all carry. Front bunkers grab anything short. Favor the center.","Tight fairway with trouble left. Keep your tee shot right-center for the best angle in.","Elevation change makes this play shorter than the card. Trust the yardage from the tee.","Strong finisher to the front nine. Accurate drive is more important than distance here.","Welcome to the ocean holes. Clifftop par 4 \u2014 stunning and demanding. Favor the left side.","Iconic par 3 on the ocean bluffs. Wind is a factor. Check conditions before committing.","Dogleg right with the ocean on your right. Don't get distracted by the views.","Long par 5 along the cliffs. Three smart shots beat two heroic ones here.","Tough par 4 with elevation. Number 2 handicap hole \u2014 two solid shots to get home.","Longest hole on the course at 600+. Three full shots, uphill finish. Par is a great score.","Back inland now. Straightforward par 4 with a receptive green. Birdie opportunity.","Long par 4 playing into the prevailing wind. Club up and keep it below the hole.","Finishing par 3 \u2014 shorter than it looks. Pin position matters. End your round strong."]}
];
const GOLF_API="PS7CU654LQUULN2VZ2EKPGWXAI";
const getCourse=(id)=>COURSES.find(c=>c.id===id)||COURSES[0];
const apiToLocal=(c,teeData)=>{
if(!c)return null;
const tees={};const gender=teeData.male&&teeData.male.length?'male':'female';
(teeData[gender]||[]).forEach(t=>{
const k=t.tee_name.toLowerCase().replace(/\s+/g,'_');
tees[k]={r:t.course_rating,s:t.slope_rating,y:t.holes.map(h=>h.yardage)};
});
if(!Object.keys(tees).length)return null;
const firstTee=teeData[gender][0];
return{id:"api_"+c.id,name:c.club_name+(c.course_name&&c.course_name!==c.club_name?" - "+c.course_name:""),loc:c.location.city+", "+c.location.state,par:firstTee.par_total,holes:firstTee.number_of_holes,greens:firstTee.holes.map(()=>({lat:c.location.latitude,lng:c.location.longitude})),tees,pars:firstTee.holes.map(h=>h.par),tips:[],apiCourse:true};
};
const searchCourses=async(q)=>{
if(!q||q.length<2)return[];
try{const r=await fetch("https://api.golfcourseapi.com/v1/search?search_query="+encodeURIComponent(q),{headers:{"Authorization":"Key "+GOLF_API}});
const d=await r.json();return(d.courses||[]).slice(0,8).map(c=>{const conv=apiToLocal(c,c.tees||{});return conv?{...conv,_raw:c}:null;}).filter(Boolean);}catch(e){console.error(e);return[];}
};
const genId=()=>Math.random().toString(36).substr(2,9);
const gpsDist=(a,b,c,d)=>{const R=6371000,tr=x=>x*Math.PI/180,dl=tr(c-a),dn=tr(d-b),s=Math.sin(dl/2)**2+Math.cos(tr(a))*Math.cos(tr(c))*Math.sin(dn/2)**2;return Math.round(R*2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*1.09361);};
const calcHcp=(rounds)=>{const v=rounds.filter(r=>r.holes&&r.holes.length===18&&r.cr&&r.sr);if(v.length<5)return null;const d=v.map(r=>((r.holes.reduce((s,h)=>s+(h.sc||0),0)-r.cr)*113)/r.sr).sort((a,b)=>a-b);const n=Math.max(1,Math.floor(d.length*0.4));return Math.round(d.slice(0,n).reduce((s,x)=>s+x,0)/n*10)/10;};
const useGPS=()=>{
const[pos,setPos]=useState(null);const[err,setErr]=useState(null);const[on,setOn]=useState(false);const ref=useRef(null);
const start=useCallback(()=>{if(!navigator.geolocation){setErr("GPS unavailable");return;}setOn(true);ref.current=navigator.geolocation.watchPosition(p=>setPos({lat:p.coords.latitude,lng:p.coords.longitude,acc:p.coords.accuracy}),e=>setErr(e.message),{enableHighAccuracy:true,maximumAge:3000,timeout:10000});},[]);
const stop=useCallback(()=>{if(ref.current!==null){navigator.geolocation.clearWatch(ref.current);ref.current=null;}setOn(false);},[]);
const once=useCallback(()=>new Promise((res,rej)=>{if(!navigator.geolocation){rej("GPS unavailable");return;}navigator.geolocation.getCurrentPosition(p=>{const o={lat:p.coords.latitude,lng:p.coords.longitude,acc:p.coords.accuracy};setPos(o);res(o);},e=>{setErr(e.message);rej(e.message);},{enableHighAccuracy:true,timeout:10000});}),[]);
return{pos,err,on,start,stop,once};
};
const F="'Outfit',sans-serif",M="'JetBrains Mono',monospace";
const dark={bg:"#09090b",card:"#111114",bdr:"rgba(255,255,255,0.05)",g:"#34d399",gd:"rgba(52,211,153,0.07)",gb:"rgba(52,211,153,0.12)",tx:"#e4e4e7",tm:"#71717a",td:"#3f3f46",r:"#f87171",o:"#fb923c",b:"#60a5fa",y:"#fbbf24",rd:"rgba(248,113,113,0.08)",od:"rgba(251,146,60,0.08)",bd:"rgba(96,165,250,0.08)",mapBg:"#0d1117",mapGreen:"#22c55e",mapShot:"#f59e0b",mapLine:"rgba(245,158,11,0.4)"};
const light={bg:"#f4f4f5",card:"#ffffff",bdr:"rgba(0,0,0,0.06)",g:"#059669",gd:"rgba(5,150,105,0.06)",gb:"rgba(5,150,105,0.12)",tx:"#18181b",tm:"#71717a",td:"#a1a1aa",r:"#dc2626",o:"#ea580c",b:"#2563eb",y:"#d97706",rd:"rgba(220,38,38,0.06)",od:"rgba(234,88,12,0.06)",bd:"rgba(37,99,235,0.06)",mapBg:"#e8f5e9",mapGreen:"#2e7d32",mapShot:"#e65100",mapLine:"rgba(230,81,0,0.4)"};
// ==================== AUTH SCREENS ====================
const Spinner=({T,size=20})=><div style={{width:size,height:size,border:"2px solid "+T.bdr,borderTop:"2px solid "+T.g,borderRadius:"50%",animation:"spin 0.6s linear infinite",margin:"0 auto"}}/>;

const LOGO=()=><svg viewBox="0 0 200 52" fill="none" xmlns="http://www.w3.org/2000/svg" style={{width:160,height:"auto"}}>
<defs><linearGradient id="gflag" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stopColor="#34d399"/><stop offset="100%" stopColor="#059669"/></linearGradient></defs>
<line x1="8" y1="4" x2="8" y2="38" stroke="url(#gflag)" strokeWidth="2.5" strokeLinecap="round"/>
<path d="M10 4 L26 10.5 L10 17Z" fill="url(#gflag)" opacity="0.9"/>
<circle cx="8" cy="40" r="2.5" fill="#34d399" opacity="0.35"/>
<text x="36" y="32" fontFamily="'Outfit',sans-serif" fontWeight="800" fontSize="30" letterSpacing="-1.5" fill="white">STICKS</text>
</svg>;

function AuthScreen({onAuth,T}){
const[mode,setMode]=useState("landing"); // landing, login, signup, reset
const[email,setEmail]=useState("");
const[password,setPassword]=useState("");
const[name,setName]=useState("");
const[loading,setLoading]=useState(false);
const[error,setError]=useState("");
const[msg,setMsg]=useState("");
const handleLogin=async()=>{
setLoading(true);setError("");
const{data,error:e}=await sb.auth.signInWithPassword({email,password});
if(e){setError(e.message);setLoading(false);return;}
onAuth(data.user);
};
const handleSignup=async()=>{
if(!name.trim()){setError("Name is required");return;}
if(password.length<6){setError("Password must be at least 6 characters");return;}
setLoading(true);setError("");
const{data,error:e}=await sb.auth.signUp({email,password,options:{data:{name:name.trim()}}});
if(e){setError(e.message);setLoading(false);return;}
if(data.user&&!data.user.confirmed_at&&!data.session){
setMsg("Check your email for a confirmation link!");setLoading(false);setMode("login");return;
}
onAuth(data.user);
};
const handleReset=async()=>{
setLoading(true);setError("");
const{error:e}=await sb.auth.resetPasswordForEmail(email,{redirectTo:window.location.origin});
if(e){setError(e.message);setLoading(false);return;}
setMsg("Password reset link sent to your email");setLoading(false);setMode("login");
};
const submit=mode==="login"?handleLogin:mode==="signup"?handleSignup:handleReset;
const inputS={width:"100%",background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:12,padding:"14px 16px",color:"#fff",fontSize:15,fontFamily:F,outline:"none",boxSizing:"border-box",marginBottom:10,transition:"border-color 0.15s"};

if(mode==="landing"){
return <div style={{minHeight:"100vh",background:"#050507",display:"flex",flexDirection:"column",justifyContent:"space-between"}}>
<div style={{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",padding:"0 32px"}}>
<div style={{marginBottom:40}}><LOGO/></div>
<h1 style={{fontSize:32,fontWeight:800,color:"#fff",margin:"0 0 12px",fontFamily:F,lineHeight:1.1,letterSpacing:"-0.03em"}}>Track your game.<br/>Know your numbers.</h1>
<p style={{fontSize:15,color:"rgba(255,255,255,0.35)",fontFamily:F,margin:0,lineHeight:1.6,maxWidth:320}}>GPS shot tracking, handicap index, club distances, and scoring stats. Free forever.</p>
</div>
<div style={{padding:"0 32px 48px"}}>
<button onClick={()=>setMode("signup")} style={{width:"100%",padding:"16px",borderRadius:14,background:"#34d399",color:"#050507",fontSize:16,fontWeight:700,fontFamily:F,border:"none",cursor:"pointer",marginBottom:10,letterSpacing:"0.01em"}}>Create Free Account</button>
<button onClick={()=>setMode("login")} style={{width:"100%",padding:"15px",borderRadius:14,background:"transparent",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.45)",fontSize:14,fontWeight:600,fontFamily:F,cursor:"pointer"}}>Sign In</button>
<div style={{display:"flex",justifyContent:"center",gap:28,marginTop:28}}>
{[{n:"30K+",l:"Courses"},{n:"FREE",l:"Handicap"},{n:"\u221E",l:"Rounds"}].map(x=><div key={x.l} style={{textAlign:"center"}}><div style={{fontSize:14,fontWeight:800,color:"#34d399",fontFamily:M}}>{x.n}</div><div style={{fontSize:9,color:"rgba(255,255,255,0.18)",fontFamily:F,textTransform:"uppercase",letterSpacing:"0.12em",marginTop:2}}>{x.l}</div></div>)}
</div>
</div>
</div>;
}

return <div style={{minHeight:"100vh",background:"#050507",display:"flex",flexDirection:"column"}}>
<div style={{padding:"52px 28px 0",flex:"0 0 auto"}}>
<button onClick={()=>{setMode("landing");setError("");setMsg("");}} style={{background:"rgba(255,255,255,0.04)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,padding:"8px 14px",cursor:"pointer",color:"rgba(255,255,255,0.5)",fontSize:13,fontFamily:F,fontWeight:600}}>{"\u2190 Back"}</button>
</div>
<div style={{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",padding:"0 28px",maxWidth:400,margin:"0 auto",width:"100%",boxSizing:"border-box"}}>
<h2 style={{fontSize:26,fontWeight:800,color:"#fff",margin:"0 0 4px",fontFamily:F}}>{mode==="login"?"Welcome back":mode==="signup"?"Create account":"Reset password"}</h2>
<p style={{fontSize:13,color:"rgba(255,255,255,0.28)",fontFamily:F,margin:"0 0 28px"}}>{mode==="login"?"Sign in to sync your rounds":mode==="signup"?"Start tracking for free":"We\u2019ll email you a reset link"}</p>
{mode==="signup"&&<input type="text" value={name} onChange={e=>setName(e.target.value)} placeholder="Your name" style={inputS} autoComplete="name"/>}
<input type="email" value={email} onChange={e=>setEmail(e.target.value)} placeholder="Email address" style={inputS} autoComplete="email"/>
{mode!=="reset"&&<input type="password" value={password} onChange={e=>setPassword(e.target.value)} placeholder="Password" style={inputS} autoComplete={mode==="signup"?"new-password":"current-password"} onKeyDown={e=>{if(e.key==="Enter"&&!loading)submit();}}/>}
{error&&<div style={{color:"#f87171",fontSize:12,fontFamily:F,marginBottom:10,padding:"10px 14px",background:"rgba(248,113,113,0.06)",borderRadius:10,border:"1px solid rgba(248,113,113,0.1)"}}>{error}</div>}
{msg&&<div style={{color:"#34d399",fontSize:12,fontFamily:F,marginBottom:10,padding:"10px 14px",background:"rgba(52,211,153,0.06)",borderRadius:10,border:"1px solid rgba(52,211,153,0.1)"}}>{msg}</div>}
<button disabled={loading} onClick={submit} style={{width:"100%",padding:"16px",borderRadius:14,background:"#34d399",color:"#050507",fontSize:15,fontWeight:700,fontFamily:F,border:"none",cursor:loading?"not-allowed":"pointer",opacity:loading?0.7:1,marginTop:4}}>
{loading?<Spinner T={{...T,g:"#050507",bdr:"#050507"+"44"}} size={18}/>:mode==="login"?"Sign In":mode==="signup"?"Create Account":"Send Reset Link"}
</button>
{mode==="login"&&<div style={{display:"flex",justifyContent:"space-between",marginTop:18}}>
<button onClick={()=>{setMode("signup");setError("");}} style={{background:"none",border:"none",color:"#34d399",fontSize:12,fontFamily:F,cursor:"pointer",fontWeight:600}}>Create account</button>
<button onClick={()=>{setMode("reset");setError("");}} style={{background:"none",border:"none",color:"rgba(255,255,255,0.2)",fontSize:12,fontFamily:F,cursor:"pointer"}}>Forgot password?</button>
</div>}
{mode==="signup"&&<div style={{textAlign:"center",marginTop:18}}>
<button onClick={()=>{setMode("login");setError("");setMsg("");}} style={{background:"none",border:"none",color:"rgba(255,255,255,0.3)",fontSize:12,fontFamily:F,cursor:"pointer"}}>Already have an account? <span style={{color:"#34d399",fontWeight:600}}>Sign in</span></button>
</div>}
{mode==="reset"&&<div style={{textAlign:"center",marginTop:18}}>
<button onClick={()=>{setMode("login");setError("");setMsg("");}} style={{background:"none",border:"none",color:"rgba(255,255,255,0.3)",fontSize:12,fontFamily:F,cursor:"pointer"}}>Back to sign in</button>
</div>}
</div>
</div>;
}
// ==================== UI COMPONENTS ====================
const Avatar=({name,color,size=40})=>{const i=(name||"?")[0].toUpperCase();return <div style={{width:size,height:size,borderRadius:size/2,background:color||"#34d399",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><span style={{fontSize:size*0.42,fontWeight:700,color:"#fff",fontFamily:F}}>{i}</span></div>;};
const HOLE_DESIGNS=[
{fw:"M50,385 Q50,300 48,240 Q46,180 52,130 Q56,90 58,55",bunkers:[{x:68,y:78,rx:8,ry:5},{x:32,y:195,rx:6,ry:4}],green:{x:58,y:42,rx:14,ry:12},trees:[{x:22,y:150,s:8},{x:78,y:165,s:7},{x:82,y:115,s:9},{x:18,y:95,s:6},{x:80,y:245,s:7}],water:[],dogleg:"right",elev:""},
{fw:"M50,385 Q50,300 50,200 Q50,140 50,80",bunkers:[{x:36,y:72,rx:7,ry:5},{x:64,y:68,rx:6,ry:5}],green:{x:50,y:52,rx:13,ry:11},trees:[{x:20,y:175,s:8},{x:80,y:195,s:7},{x:18,y:115,s:6},{x:82,y:125,s:7}],water:[],dogleg:"",elev:"uphill"},
{fw:"M50,385 Q50,300 48,220 Q44,160 40,120 Q36,90 34,60",bunkers:[{x:24,y:68,rx:7,ry:4},{x:48,y:98,rx:5,ry:4}],green:{x:34,y:42,rx:16,ry:11},trees:[{x:78,y:155,s:9},{x:20,y:175,s:7},{x:72,y:95,s:8},{x:12,y:85,s:6}],water:[],dogleg:"left",elev:""},
{fw:"M50,385 Q50,320 50,240 Q50,170 50,110 Q50,80 50,50",bunkers:[{x:34,y:108,rx:6,ry:4},{x:66,y:58,rx:7,ry:5},{x:28,y:198,rx:5,ry:3}],green:{x:50,y:38,rx:13,ry:11},trees:[{x:18,y:148,s:8},{x:82,y:175,s:9},{x:22,y:245,s:7},{x:80,y:95,s:7}],water:[],dogleg:"",elev:""},
{fw:"M50,385 Q50,310 48,230 Q46,170 48,110",bunkers:[{x:34,y:105,rx:6,ry:4}],green:{x:48,y:78,rx:12,ry:10},trees:[{x:20,y:195,s:7},{x:80,y:215,s:8},{x:77,y:135,s:6},{x:22,y:128,s:7}],water:[],dogleg:"",elev:""},
{fw:"M50,385 Q50,310 48,220 Q46,155 44,100",bunkers:[{x:30,y:88,rx:7,ry:4},{x:58,y:82,rx:5,ry:4}],green:{x:44,y:62,rx:13,ry:11},trees:[{x:18,y:155,s:7},{x:82,y:175,s:8}],water:[{path:"M72,195 Q76,158 73,118 Q71,98 68,88",w:12}],dogleg:"",elev:""},
{fw:"M50,385 Q50,310 50,210 Q50,155 52,105",bunkers:[{x:38,y:92,rx:6,ry:4},{x:66,y:97,rx:5,ry:4}],green:{x:52,y:68,rx:12,ry:10},trees:[{x:23,y:215,s:8},{x:80,y:195,s:7},{x:20,y:128,s:6},{x:82,y:138,s:7}],water:[],dogleg:"",elev:""},
{fw:"M50,385 Q50,315 50,240 Q50,170 48,110 Q46,80 44,52",bunkers:[{x:58,y:58,rx:7,ry:4},{x:30,y:118,rx:5,ry:4},{x:67,y:178,rx:6,ry:3}],green:{x:44,y:38,rx:15,ry:11},trees:[{x:18,y:195,s:8},{x:82,y:215,s:9},{x:77,y:98,s:7},{x:16,y:95,s:7}],water:[],dogleg:"",elev:""},
{fw:"M50,385 Q50,320 50,250 Q50,195 50,145",bunkers:[{x:36,y:128,rx:5,ry:4}],green:{x:50,y:105,rx:11,ry:10},trees:[{x:23,y:248,s:7},{x:77,y:258,s:6},{x:20,y:168,s:7},{x:80,y:178,s:6}],water:[],dogleg:"",elev:"downhill"},
{fw:"M50,385 Q50,315 50,240 Q48,170 44,118 Q40,88 38,55",bunkers:[{x:28,y:148,rx:7,ry:4},{x:50,y:60,rx:6,ry:4}],green:{x:38,y:42,rx:13,ry:11},trees:[{x:18,y:195,s:8},{x:82,y:178,s:9},{x:77,y:108,s:7},{x:15,y:118,s:6}],water:[],dogleg:"",elev:"downhill"},
{fw:"M50,385 Q50,310 50,230 Q50,158 50,108",bunkers:[{x:36,y:98,rx:6,ry:4},{x:64,y:102,rx:5,ry:4}],green:{x:50,y:72,rx:12,ry:10},trees:[{x:20,y:195,s:8},{x:80,y:208,s:7},{x:18,y:128,s:6},{x:82,y:138,s:7}],water:[],dogleg:"",elev:"uphill"},
{fw:"M50,385 Q50,315 50,245 Q46,175 38,125 Q32,95 28,62",bunkers:[{x:18,y:68,rx:6,ry:4},{x:42,y:108,rx:5,ry:3},{x:68,y:198,rx:6,ry:4}],green:{x:28,y:45,rx:13,ry:11},trees:[{x:78,y:148,s:9},{x:82,y:98,s:8},{x:18,y:175,s:7},{x:12,y:78,s:6}],water:[],dogleg:"left",elev:"uphill"},
{fw:"M50,385 Q50,310 50,230 Q50,158 50,108",bunkers:[{x:36,y:98,rx:6,ry:5},{x:64,y:95,rx:5,ry:4}],green:{x:50,y:72,rx:12,ry:10},trees:[{x:23,y:198,s:8},{x:80,y:208,s:7},{x:20,y:128,s:7},{x:82,y:138,s:6}],water:[],dogleg:"",elev:"uphill"},
{fw:"M50,385 Q50,315 52,240 Q56,175 62,125 Q66,95 66,62",bunkers:[{x:55,y:60,rx:8,ry:5},{x:78,y:98,rx:5,ry:4}],green:{x:66,y:42,rx:13,ry:11},trees:[{x:22,y:178,s:8},{x:28,y:118,s:7},{x:82,y:195,s:9},{x:85,y:78,s:6}],water:[],dogleg:"right",elev:""},
{fw:"M50,395 Q50,340 50,275 Q50,215 50,155 Q50,105 50,58 Q50,35 50,18",bunkers:[{x:64,y:148,rx:6,ry:4},{x:34,y:98,rx:7,ry:4},{x:62,y:28,rx:6,ry:5}],green:{x:50,y:15,rx:14,ry:12},trees:[{x:18,y:248,s:9},{x:82,y:258,s:8},{x:16,y:148,s:7},{x:84,y:158,s:8},{x:20,y:58,s:7},{x:80,y:68,s:7}],water:[],dogleg:"",elev:"downhill"},
{fw:"M50,385 Q50,315 50,240 Q48,170 44,118 Q40,88 38,55",bunkers:[{x:26,y:58,rx:7,ry:4},{x:56,y:118,rx:5,ry:3}],green:{x:38,y:38,rx:14,ry:12},trees:[{x:18,y:195,s:8},{x:82,y:178,s:9},{x:77,y:98,s:7},{x:16,y:95,s:6}],water:[],dogleg:"",elev:"downhill"},
{fw:"M50,385 Q50,310 50,230 Q50,158 50,108",bunkers:[{x:64,y:95,rx:6,ry:5},{x:36,y:98,rx:5,ry:4}],green:{x:50,y:68,rx:13,ry:11},trees:[{x:20,y:198,s:8},{x:80,y:208,s:7},{x:18,y:128,s:7},{x:84,y:128,s:6}],water:[],dogleg:"",elev:"uphill"},
{fw:"M50,385 Q50,315 50,240 Q50,170 50,110 Q50,80 50,50",bunkers:[{x:34,y:108,rx:6,ry:4},{x:66,y:58,rx:7,ry:5}],green:{x:50,y:38,rx:13,ry:11},trees:[{x:20,y:198,s:8},{x:80,y:215,s:9},{x:18,y:128,s:7},{x:82,y:98,s:7}],water:[],dogleg:"",elev:""}
];
function ShotMap({shots,holeIdx,courseId,theme:T,livePos,teeCoords}){
const course=getCourse(courseId);const hasShots=shots&&shots.length>0;
const hole=HOLE_DESIGNS[holeIdx]||HOLE_DESIGNS[0];
const hp=course.pars[holeIdx]||4;
const teeKey=Object.keys(course.tees)[0];const hy=course.tees[teeKey]?course.tees[teeKey].y[holeIdx]:0;
const isDk=T.bg==="#09090b";
const tip=course.tips?course.tips[holeIdx]:"";
const rough=isDk?"#1a3a1a":"#2d5a2d";const fairway=isDk?"#245a30":"#3a8a4a";const greenC=isDk?"#2a7a3a":"#4aaa5a";
const sandC=isDk?"#8a7a5a":"#d4c090";const waterC=isDk?"#1a4a6a":"#4a9adf";
const treeC=isDk?"#0d2a10":"#1a4a20";const treeLt=isDk?"#1a4020":"#2a6a35";
const groundC=isDk?"#0f1a0f":"#1a3a1a";
const yardMarks=[];
if(hy>=200)yardMarks.push({yd:100,y:385-((100/hy)*345)});
if(hy>=280)yardMarks.push({yd:150,y:385-((150/hy)*345)});
if(hy>=350)yardMarks.push({yd:200,y:385-((200/hy)*345)});
if(hy>=420)yardMarks.push({yd:250,y:385-((250/hy)*345)});
return(<div style={{marginBottom:10}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
<div style={{fontSize:10,color:T.td,textTransform:"uppercase",letterSpacing:"0.1em",fontFamily:F,fontWeight:600}}>{"Hole "+(holeIdx+1)+" \u00b7 Par "+hp}</div>
<div style={{fontSize:10,color:T.g,fontWeight:700,fontFamily:M}}>{hy+" yd"}</div>
</div>
<div style={{position:"relative",width:"100%",background:groundC,borderRadius:12,border:"1px solid "+T.bdr,overflow:"hidden"}}>
<svg viewBox="0 0 100 420" preserveAspectRatio="xMidYMid meet" style={{width:"100%",display:"block"}}>
<defs>
<radialGradient id={"rg"+holeIdx} cx="50%" cy="40%" r="55%"><stop offset="0%" stopColor={rough} stopOpacity="0.95"/><stop offset="100%" stopColor={groundC}/></radialGradient>
<filter id="gblur"><feGaussianBlur stdDeviation="1.8"/></filter>
<filter id="sblur"><feGaussianBlur stdDeviation="0.6"/></filter>
<linearGradient id="fwgrad" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stopColor={fairway} stopOpacity="0.6"/><stop offset="30%" stopColor={isDk?"#2a6a3a":"#4a9a55"} stopOpacity="1"/><stop offset="70%" stopColor={isDk?"#2a6a3a":"#4a9a55"} stopOpacity="1"/><stop offset="100%" stopColor={fairway} stopOpacity="0.6"/></linearGradient>
</defs>
<rect x="0" y="0" width="100" height="420" fill={"url(#rg"+holeIdx+")"}/>
{hole.trees.map((t,i)=><g key={"t"+i} opacity="0.85"><circle cx={t.x} cy={t.y} r={t.s+4} fill={treeC} opacity="0.4" filter="url(#gblur)"/><circle cx={t.x} cy={t.y} r={t.s} fill={treeLt}/><circle cx={t.x-1.5} cy={t.y-1.5} r={t.s*0.55} fill={isDk?"#2a5530":"#3a7a45"} opacity="0.6"/><circle cx={t.x+1} cy={t.y+1} r={t.s*0.35} fill={treeC} opacity="0.4"/></g>)}
<path d={hole.fw} stroke={fairway} strokeWidth="34" fill="none" strokeLinecap="round" filter="url(#gblur)" opacity="0.5"/>
<path d={hole.fw} stroke="url(#fwgrad)" strokeWidth="28" fill="none" strokeLinecap="round"/>
<path d={hole.fw} stroke={isDk?"#2e7e42":"#55b565"} strokeWidth="18" fill="none" strokeLinecap="round" opacity="0.35"/>
<path d={hole.fw} stroke={isDk?"rgba(255,255,255,0.03)":"rgba(255,255,255,0.06)"} strokeWidth="1" fill="none" strokeLinecap="round" strokeDasharray="2,8"/>
{hole.water.map((w,i)=><g key={"w"+i}><path d={w.path} stroke={isDk?"#0a3a5a":"#3a8acc"} strokeWidth={(w.w||10)+4} fill="none" strokeLinecap="round" opacity="0.3" filter="url(#gblur)"/><path d={w.path} stroke={waterC} strokeWidth={w.w||10} fill="none" strokeLinecap="round" opacity="0.75"/><path d={w.path} stroke={isDk?"#3a7aaa":"#6abaee"} strokeWidth={Math.max(1,(w.w||10)-6)} fill="none" strokeLinecap="round" opacity="0.3"/></g>)}
{hole.bunkers.map((b,i)=><g key={"b"+i}><ellipse cx={b.x} cy={b.y} rx={b.rx+2} ry={b.ry+2} fill={isDk?"#3a2a0a":"#8a6a30"} opacity="0.3" filter="url(#sblur)"/><ellipse cx={b.x} cy={b.y} rx={b.rx} ry={b.ry} fill={sandC} opacity="0.9"/><ellipse cx={b.x-0.8} cy={b.y-0.5} rx={b.rx*0.55} ry={b.ry*0.55} fill={isDk?"#a09070":"#e8d8b0"} opacity="0.45"/><ellipse cx={b.x} cy={b.y} rx={b.rx} ry={b.ry} fill="none" stroke={isDk?"#6a5a2a":"#b09060"} strokeWidth="0.4" opacity="0.5"/></g>)}
<ellipse cx={hole.green.x} cy={hole.green.y} rx={hole.green.rx+3} ry={hole.green.ry+3} fill={isDk?"#0a3a15":"#1a5a25"} opacity="0.4" filter="url(#sblur)"/>
<ellipse cx={hole.green.x} cy={hole.green.y} rx={hole.green.rx} ry={hole.green.ry} fill={greenC}/>
<ellipse cx={hole.green.x} cy={hole.green.y} rx={hole.green.rx*0.65} ry={hole.green.ry*0.65} fill={isDk?"#35954a":"#5ec06a"} opacity="0.3"/>
<ellipse cx={hole.green.x} cy={hole.green.y} rx={hole.green.rx} ry={hole.green.ry} fill="none" stroke="rgba(255,255,255,0.2)" strokeWidth="0.5"/>
<circle cx={hole.green.x} cy={hole.green.y-2} r="1.3" fill="#fff" opacity="0.9"/>
<line x1={hole.green.x} y1={hole.green.y-2} x2={hole.green.x} y2={hole.green.y-10} stroke="#fff" strokeWidth="0.7" opacity="0.9"/>
<polygon points={(hole.green.x)+","+(hole.green.y-12)+" "+(hole.green.x+5.5)+","+(hole.green.y-10)+" "+(hole.green.x)+","+(hole.green.y-8)} fill="#ef4444"/>
{yardMarks.map(m=><g key={m.yd}>
<line x1="18" y1={m.y} x2="82" y2={m.y} stroke="rgba(255,255,255,0.08)" strokeWidth="0.3" strokeDasharray="1.5,3"/>
<rect x="1" y={m.y-5.5} width="15" height="11" rx="2.5" fill="rgba(0,0,0,0.55)" stroke="rgba(255,255,255,0.08)" strokeWidth="0.3"/>
<text x="8.5" y={m.y+1.5} textAnchor="middle" fill="rgba(255,255,255,0.65)" fontSize="5.5" fontFamily="monospace" fontWeight="700">{m.yd}</text>
</g>)}
<rect x="44" y="378" width="12" height="7" rx="1.5" fill={isDk?"#2a6aaa":"#4a8add"} stroke="rgba(255,255,255,0.5)" strokeWidth="0.5"/>
<text x="50" y="383.5" textAnchor="middle" fill="#fff" fontSize="4" fontFamily="monospace" fontWeight="800">TEE</text>
<rect x="68" y="372" width="30" height="42" rx="4" fill="rgba(0,0,0,0.65)" stroke="rgba(255,255,255,0.08)" strokeWidth="0.3"/>
<text x="83" y="385" textAnchor="middle" fill={T.g} fontSize="5.5" fontFamily="monospace" fontWeight="700">{"PAR "+hp}</text>
<text x="83" y="396" textAnchor="middle" fill="#fff" fontSize="9" fontFamily="monospace" fontWeight="800">{hy}</text>
<text x="83" y="405" textAnchor="middle" fill="rgba(255,255,255,0.35)" fontSize="4.5" fontFamily="monospace" fontWeight="600">YDS</text>
{hole.elev&&<g>
<rect x="2" y="372" width="20" height="14" rx="2.5" fill="rgba(0,0,0,0.55)"/>
<text x="12" y="381.5" textAnchor="middle" fill={hole.elev==="uphill"?"#f59e0b":"#60a5fa"} fontSize="4.5" fontFamily="monospace" fontWeight="700">{hole.elev==="uphill"?"\u25B2 UP":"\u25BC DN"}</text>
</g>}
{hole.dogleg&&<g>
<rect x="2" y={hole.elev?"355":"372"} width="20" height="14" rx="2.5" fill="rgba(0,0,0,0.55)"/>
<text x="12" y={hole.elev?"364.5":"381.5"} textAnchor="middle" fill="rgba(255,255,255,0.55)" fontSize="4" fontFamily="monospace" fontWeight="700">{hole.dogleg==="left"?"\u21B0 DGL":"\u21B1 DGR"}</text>
</g>}
</svg>
</div>
{tip&&<div style={{marginTop:6,padding:"8px 10px",background:T.card,borderRadius:8,border:"1px solid "+T.bdr,fontSize:11,color:T.tm,fontFamily:F,lineHeight:"1.5"}}>{"\uD83C\uDFCC\uFE0F "+tip}</div>}
<div style={{display:"flex",justifyContent:"space-around",marginTop:6,padding:"6px 0",background:T.card,borderRadius:8,border:"1px solid "+T.bdr}}>
<div style={{textAlign:"center"}}><div style={{fontSize:11,fontWeight:800,fontFamily:M,color:T.g}}>{Math.max(0,hy-15)}</div><div style={{fontSize:8,color:T.td,fontFamily:F,textTransform:"uppercase",letterSpacing:"0.08em"}}>Front</div></div>
<div style={{textAlign:"center"}}><div style={{fontSize:13,fontWeight:800,fontFamily:M,color:T.tx}}>{hy}</div><div style={{fontSize:8,color:T.td,fontFamily:F,textTransform:"uppercase",letterSpacing:"0.08em"}}>Middle</div></div>
<div style={{textAlign:"center"}}><div style={{fontSize:11,fontWeight:800,fontFamily:M,color:T.r}}>{hy+15}</div><div style={{fontSize:8,color:T.td,fontFamily:F,textTransform:"uppercase",letterSpacing:"0.08em"}}>Back</div></div>
</div>
</div>);
}
function Scorecard({holes,onTap,T}){
const f9=holes.filter((_,i)=>i<9),b9=holes.filter((_,i)=>i>=9);const sum=(arr,k)=>arr.reduce((s,h)=>s+(h[k]||0),0);
const thS={color:T.td,padding:"3px 5px",textAlign:"center",fontWeight:600,fontSize:9,textTransform:"uppercase",letterSpacing:"0.08em"};
const row=(x,i)=>{const d=x.sc-x.par,cl=d<0?T.g:d===0?T.b:T.o;return <tr key={i} onClick={()=>onTap(i)} style={{cursor:"pointer"}}><td style={{color:T.td,padding:"5px",textAlign:"center",fontFamily:M}}>{i+1}</td><td style={{color:T.td,padding:"5px",textAlign:"center"}}>{x.par}</td><td style={{color:cl,padding:"5px",textAlign:"center",fontWeight:700,fontFamily:M}}>{x.sc}</td><td style={{color:T.td,padding:"5px",textAlign:"center"}}>{x.pt}</td><td style={{color:T.td,padding:"5px",textAlign:"center",fontSize:10}}>{x.cl||"\u2014"}</td></tr>;};
const sub=(label,arr)=><tr style={{background:T.gd,fontWeight:700}}><td style={{padding:"5px",textAlign:"center",color:T.g,fontFamily:F,fontSize:10,fontWeight:700}}>{label}</td><td style={{padding:"5px",textAlign:"center",color:T.tm,fontSize:11}}>{sum(arr,"par")}</td><td style={{padding:"5px",textAlign:"center",color:T.tx,fontWeight:700,fontFamily:M,fontSize:11}}>{sum(arr,"sc")}</td><td style={{padding:"5px",textAlign:"center",color:T.tm,fontSize:11}}>{sum(arr,"pt")}</td><td style={{padding:"5px"}}></td></tr>;
return <div style={{overflowX:"auto"}}><table style={{width:"100%",borderCollapse:"collapse",fontFamily:F,fontSize:11}}><thead><tr>{["H","Par","Scr","Ptt","Club"].map(x=><th key={x} style={thS}>{x}</th>)}</tr></thead><tbody>{f9.map((x,i)=>row(x,i))}{f9.length===9&&sub("OUT",f9)}{b9.map((x,i)=>row(x,i+9))}{b9.length===9&&sub("IN",b9)}{holes.length===18&&<tr style={{background:T.g+"11",fontWeight:700}}><td style={{padding:"5px",textAlign:"center",color:T.g,fontFamily:F,fontSize:10,fontWeight:700}}>TOT</td><td style={{padding:"5px",textAlign:"center",color:T.tm,fontSize:11}}>{sum(holes,"par")}</td><td style={{padding:"5px",textAlign:"center",color:T.tx,fontWeight:700,fontFamily:M,fontSize:12}}>{sum(holes,"sc")}</td><td style={{padding:"5px",textAlign:"center",color:T.tm,fontSize:11}}>{sum(holes,"pt")}</td><td style={{padding:"5px"}}></td></tr>}</tbody></table></div>;
}
const TabBar=({active:a,onChange:o,T})=>(<div style={{position:"fixed",bottom:0,left:0,right:0,zIndex:100,background:T.bg+"ee",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:"1px solid "+T.bdr,display:"flex",justifyContent:"space-around",padding:"10px 0 env(safe-area-inset-bottom, 14px)"}}>{["Stats","Play","Rounds","Bag","Me"].map((t,i)=>{const id=["dashboard","play","rounds","bag","profile"][i];return <button key={id} onClick={()=>o(id)} style={{background:"none",border:"none",cursor:"pointer",padding:"6px 12px",color:a===id?T.g:T.td,fontFamily:F,fontSize:10,fontWeight:a===id?700:500,letterSpacing:"0.06em",textTransform:"uppercase",transition:"color 0.15s"}}>{t}</button>;})}</div>);
const Hdr=({title,sub,right,T,onToggleTheme,profile})=>(<div style={{padding:"20px 20px 12px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div style={{display:"flex",alignItems:"center",gap:10}}>{profile&&<Avatar name={profile.name} color={profile.color} size={30}/>}<div>{title==="STICKS"?<div style={{display:"flex",alignItems:"center"}}><LOGO/></div>:<h1 style={{fontSize:22,fontWeight:700,color:T.tx,margin:0,fontFamily:F,letterSpacing:"-0.02em"}}>{title}</h1>}{sub&&<p style={{color:T.tm,fontSize:13,margin:"3px 0 0",fontFamily:F,fontWeight:400}}>{sub}</p>}</div></div><div style={{display:"flex",gap:8,alignItems:"center"}}>{onToggleTheme&&<button onClick={onToggleTheme} style={{background:T.gd,border:"1px solid "+T.gb,borderRadius:8,padding:"6px 10px",cursor:"pointer",color:T.g,fontSize:11,fontFamily:F,fontWeight:600}}>{T===dark?"\u2600":"Moon"}</button>}{right}</div></div>);
const Crd=({children,style:s,onClick:o,T})=><div onClick={o} style={{background:T.card,border:"1px solid "+T.bdr,borderRadius:12,padding:14,cursor:o?"pointer":"default",...s}}>{children}</div>;
const Lbl=({children,T})=><div style={{fontSize:10,color:T.td,marginBottom:7,fontFamily:F,textTransform:"uppercase",letterSpacing:"0.1em",fontWeight:600}}>{children}</div>;
const Btn=({children,onClick:o,v="primary",style:s,disabled:d,T})=>{const st={primary:{background:T.g,color:T.bg,fontWeight:700,border:"none"},secondary:{background:T.gd,color:T.g,border:"1px solid "+T.gb},ghost:{background:"transparent",color:T.tm,border:"none"},danger:{background:T.rd,color:T.r,border:"1px solid "+T.r+"18"}};return <button disabled={d} onClick={o} style={{...st[v],borderRadius:10,padding:"12px 18px",fontSize:13,fontFamily:F,cursor:d?"not-allowed":"pointer",opacity:d?0.4:1,width:"100%",transition:"all 0.15s",...s}}>{children}</button>;};
const Pill=({children,active:a,color:cl,bg,onClick:o,T})=><button onClick={o} style={{padding:"10px 0",borderRadius:8,flex:1,cursor:"pointer",background:a?(bg||T.gd):"rgba(128,128,128,0.04)",color:a?(cl||T.g):T.td,border:a?"1px solid "+(cl||T.g)+"18":"1px solid "+T.bdr,fontSize:14,fontWeight:600,fontFamily:F,transition:"all 0.12s"}}>{children}</button>;
const St=({label:l,value:v,unit:u,color:cl,small:sm,T})=><div style={{textAlign:"center"}}><div style={{fontSize:sm?18:26,fontWeight:700,color:cl||T.g,fontFamily:M,lineHeight:1}}>{v}{u&&<span style={{fontSize:sm?10:12,fontWeight:400,color:T.td,marginLeft:2}}>{u}</span>}</div><div style={{fontSize:9,color:T.td,marginTop:4,fontFamily:F,textTransform:"uppercase",letterSpacing:"0.1em",fontWeight:600}}>{l}</div></div>;
const Diff=({d,style:s,T})=><span style={{color:d<0?T.g:d===0?T.b:T.o,fontWeight:700,fontFamily:M,...s}}>{d>0?"+"+d:d===0?"E":""+d}</span>;
const ScLbl=({sc,par,T})=>{if(!sc||!par)return null;const ace=sc===1,d=sc-par;const l=ace?"ACE":d<=-3?"ALBATROSS":d===-2?"EAGLE":d===-1?"BIRDIE":d===0?"PAR":d===1?"BOGEY":d===2?"DOUBLE":"+"+d;const cl=ace?T.y:d<0?T.g:d===0?T.b:T.o;return <span style={{fontSize:11,fontWeight:700,color:cl,fontFamily:F,letterSpacing:"0.08em"}}>{l}</span>;};
// ==================== PROFILE SCREEN ====================
function ProfileScreen({profile,rounds,onUpdateProfile,onLogout,T,onToggle}){
const[editing,setEditing]=useState(false);
const[name,setName]=useState(profile.name);
const[color,setColor]=useState(profile.color);
const[homeCourse,setHomeCourse]=useState(profile.home_course||"goat_hill");
const[goal,setGoal]=useState(profile.goal||"");
const[saving,setSaving]=useState(false);
const hcp=calcHcp(rounds);const done=rounds.filter(r=>r.holes&&r.holes.length===18);
const home=getCourse(homeCourse);
const save=async()=>{setSaving(true);const up={name:name.trim(),color,home_course:homeCourse,goal:goal?parseFloat(goal):null};
const{error}=await sb.from("profiles").update(up).eq("id",profile.id);
if(!error){onUpdateProfile({...profile,...up});setEditing(false);}setSaving(false);};
if(editing)return <div><Hdr title="Edit Profile" T={T} onToggleTheme={onToggle} profile={profile}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>
<Crd T={T} style={{marginBottom:10}}>
<Lbl T={T}>Name</Lbl><input type="text" value={name} onChange={e=>setName(e.target.value)} style={{width:"100%",background:"rgba(128,128,128,0.04)",border:"1px solid "+T.bdr,borderRadius:8,padding:"11px 14px",color:T.tx,fontSize:14,fontFamily:F,outline:"none",boxSizing:"border-box",marginBottom:12}}/>
<Lbl T={T}>Color</Lbl><div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:12}}>{AVATARS.map(c=><button key={c} onClick={()=>setColor(c)} style={{width:32,height:32,borderRadius:16,background:c,border:color===c?"3px solid "+T.tx:"3px solid transparent",cursor:"pointer"}}/>)}</div>
<Lbl T={T}>Home Course</Lbl><div style={{display:"flex",flexDirection:"column",gap:6,marginBottom:12}}>{COURSES.map(c=>{const a=homeCourse===c.id;return <button key={c.id} onClick={()=>setHomeCourse(c.id)} style={{padding:"10px 14px",borderRadius:8,cursor:"pointer",background:a?T.gd:"rgba(128,128,128,0.02)",border:a?"1px solid "+T.gb:"1px solid "+T.bdr,color:a?T.g:T.td,fontFamily:F,textAlign:"left",fontSize:13,fontWeight:a?600:400}}>{c.name}<span style={{opacity:0.5,marginLeft:8,fontSize:11}}>{c.loc}</span></button>;})}</div>
<Lbl T={T}>Handicap Goal</Lbl><input type="number" inputMode="numeric" value={goal} onChange={e=>setGoal(e.target.value)} placeholder="e.g. 18" style={{width:"100%",background:"rgba(128,128,128,0.04)",border:"1px solid "+T.bdr,borderRadius:8,padding:"11px 14px",color:T.tx,fontSize:14,fontFamily:F,outline:"none",boxSizing:"border-box"}}/>
</Crd>
<Btn T={T} disabled={!name.trim()||saving} onClick={save}>{saving?"Saving...":"Save Changes"}</Btn>
<div style={{marginTop:8}}><Btn v="ghost" T={T} onClick={()=>setEditing(false)}>Cancel</Btn></div>
</div></div>;
return <div><Hdr title={profile.name} sub="Profile" T={T} onToggleTheme={onToggle} profile={profile}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>
{/* Profile card - clean, no image */}
<Crd T={T} style={{marginBottom:10,padding:"20px",textAlign:"center"}}>
<div style={{display:"flex",justifyContent:"center"}}><Avatar name={profile.name} color={profile.color} size={52}/></div>
<div style={{fontSize:18,fontWeight:700,color:T.tx,fontFamily:F,marginTop:8}}>{profile.name}</div>
<div style={{fontSize:11,color:T.td,fontFamily:F,marginTop:2}}>{home.name}</div>
</Crd>
<Crd T={T} style={{marginBottom:10}}>
<div style={{display:"flex",justifyContent:"center",gap:24,padding:"6px 0"}}>
<St label="Rounds" value={done.length} small T={T}/><St label="Handicap" value={hcp!=null?hcp:"\u2014"} small T={T}/><St label="Goal" value={profile.goal||"\u2014"} small T={T}/>
</div>
{hcp!=null&&profile.goal&&<div style={{marginTop:12,padding:"10px 14px",borderRadius:8,background:hcp<=profile.goal?T.gd:T.od,border:"1px solid "+(hcp<=profile.goal?T.gb:T.o+"22")}}>
<div style={{fontSize:12,fontWeight:600,color:hcp<=profile.goal?T.g:T.o,fontFamily:F}}>{hcp<=profile.goal?"\u2705 Goal reached! Handicap "+hcp+" vs goal "+profile.goal:"\u{1F3AF} "+Math.round((hcp-profile.goal)*10)/10+" strokes to go"}</div></div>}
</Crd>
<Crd T={T} style={{marginBottom:8}}><div style={{display:"flex",flexDirection:"column",gap:8}}>
<Btn v="secondary" T={T} onClick={()=>setEditing(true)}>Edit Profile</Btn>
<Btn v="danger" T={T} onClick={onLogout}>Log Out</Btn>
</div></Crd>
<div style={{textAlign:"center",padding:"20px 0"}}><div style={{fontSize:10,color:T.td,fontFamily:F}}>Member since {new Date(profile.created_at).toLocaleDateString()}</div></div>
</div></div>;
}
// ==================== DASHBOARD ====================
function Dashboard({rounds,T,onToggle,profile}){
const hcp=calcHcp(rounds);const done=rounds.filter(r=>r.holes&&r.holes.length===18);const rec=done.slice(-10);
const avg=rec.length?Math.round(rec.reduce((s,r)=>s+r.holes.reduce((a,h)=>a+(h.sc||0),0),0)/rec.length*10)/10:null;
const avgP=rec.length?Math.round(rec.reduce((s,r)=>s+r.holes.reduce((a,h)=>a+(h.pt||0),0),0)/rec.length*10)/10:null;
const ah=done.flatMap(r=>r.holes);
const girP=ah.length?Math.round(ah.filter(h=>h.gir).length/ah.length*100):null;
const fwT=ah.filter(h=>h.par>3).length;const fwP=fwT?Math.round(ah.filter(h=>h.fw==="hit").length/fwT*100):null;
const best=done.length?Math.min(...done.map(r=>r.holes.reduce((s,h)=>s+(h.sc||0),0))):null;
const dist=useMemo(()=>{const d={ace:0,eagle:0,birdie:0,par:0,bogey:0,double:0,worse:0};ah.forEach(h=>{if(!h.sc||!h.par)return;if(h.sc===1){d.ace++;return;}const x=h.sc-h.par;if(x<=-2)d.eagle++;else if(x===-1)d.birdie++;else if(x===0)d.par++;else if(x===1)d.bogey++;else if(x===2)d.double++;else d.worse++;});return d;},[done.length]);
const totH=Object.values(dist).reduce((s,v)=>s+v,0);
if(!done.length)return <div><Hdr title="STICKS" sub={profile.name+"'s stats"} T={T} onToggleTheme={onToggle} profile={profile}/><div style={{padding:"0 16px 100px"}}>
<Crd T={T} style={{marginBottom:12,padding:"24px 20px",textAlign:"center"}}>
<div style={{fontSize:36,marginBottom:8}}>⛳</div>
<h2 style={{color:T.tx,fontSize:18,fontWeight:700,margin:"0 0 6px",fontFamily:F}}>Ready to play?</h2>
<p style={{color:T.tm,fontSize:13,fontFamily:F,margin:"0 0 16px",lineHeight:1.5}}>Start your first round to see stats, handicap, and scoring trends.</p>
</Crd>
<div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:12}}>
{[{icon:"\uD83D\uDCCD",label:"GPS Tracking",desc:"Live distances"},{icon:"\uD83D\uDCCA",label:"Smart Stats",desc:"Every shot"},{icon:"\uD83C\uDFC6",label:"Handicap",desc:"Free index"}].map(f=><Crd key={f.label} T={T} style={{textAlign:"center",padding:"14px 8px"}}><div style={{fontSize:20,marginBottom:4}}>{f.icon}</div><div style={{fontSize:10,fontWeight:700,color:T.tx,fontFamily:F}}>{f.label}</div><div style={{fontSize:9,color:T.td,fontFamily:F,marginTop:2}}>{f.desc}</div></Crd>)}
</div>
</div></div>;
return <div><Hdr title="STICKS" sub={done.length+" round"+(done.length!==1?"s":"")} T={T} onToggleTheme={onToggle} profile={profile}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>
<Crd T={T} style={{marginBottom:10,padding:"18px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
<div>
<div style={{fontSize:9,color:T.td,fontWeight:700,textTransform:"uppercase",letterSpacing:"0.15em",fontFamily:F}}>Handicap Index</div>
<div style={{fontSize:38,fontWeight:800,color:T.tx,fontFamily:M,lineHeight:1,marginTop:4}}>{hcp!=null?hcp:"\u2014"}</div>
{hcp==null&&<div style={{fontSize:10,color:T.td,fontFamily:F,marginTop:4}}>Need 5+ full rounds</div>}
</div>
<div style={{fontSize:32,opacity:0.15}}>⛳</div>
</Crd>
<div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:6,marginBottom:8}}><Crd T={T}><St label="Avg" value={avg!=null?avg:"\u2014"} small T={T}/></Crd><Crd T={T}><St label="Putts" value={avgP!=null?avgP:"\u2014"} small T={T}/></Crd><Crd T={T}><St label="Best" value={best!=null?best:"\u2014"} color={T.y} small T={T}/></Crd></div>
<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:8}}><Crd T={T}><St label="GIR" value={girP!=null?girP:"\u2014"} unit="%" small T={T}/></Crd><Crd T={T}><St label="Fairways" value={fwP!=null?fwP:"\u2014"} unit="%" small T={T}/></Crd></div>
{totH>0&&<Crd T={T} style={{marginBottom:8}}><Lbl T={T}>Distribution</Lbl><div style={{display:"flex",gap:2,marginTop:6}}>{[{k:"ace",l:"Ace",c:T.y},{k:"eagle",l:"Egl",c:T.g},{k:"birdie",l:"Bir",c:T.g},{k:"par",l:"Par",c:T.b},{k:"bogey",l:"+1",c:T.o},{k:"double",l:"+2",c:T.r},{k:"worse",l:"3+",c:"#7f1d1d"}].map(s=>{const p=dist[s.k]/totH*100;return <div key={s.k} style={{flex:1,textAlign:"center"}}><div style={{height:64,display:"flex",alignItems:"flex-end",justifyContent:"center",marginBottom:5}}><div style={{width:"100%",maxWidth:24,height:Math.max(3,p)+"%",background:s.c,borderRadius:3,opacity:0.7,transition:"height 0.4s"}}/></div><div style={{fontSize:9,color:T.td,fontFamily:F}}>{s.l}</div><div style={{fontSize:12,color:T.tx,fontWeight:700,fontFamily:M}}>{dist[s.k]}</div></div>;})}</div></Crd>}
{rec.length>0&&<Crd T={T}><Lbl T={T}>Recent</Lbl>{rec.slice().reverse().slice(0,5).map(r=>{const t=r.holes.reduce((s,h)=>s+(h.sc||0),0),p=r.holes.reduce((s,h)=>s+(h.par||0),0);return <div key={r.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"9px 0",borderBottom:"1px solid "+T.bdr}}><div><div style={{color:T.tx,fontSize:13,fontWeight:600,fontFamily:F}}>{r.course_name||r.courseName}</div><div style={{color:T.td,fontSize:11,fontFamily:F}}>{new Date(r.date).toLocaleDateString()}</div></div><div style={{display:"flex",alignItems:"baseline",gap:6}}><span style={{fontSize:18,fontWeight:700,color:T.tx,fontFamily:M}}>{t}</span><Diff d={t-p} style={{fontSize:12}} T={T}/></div></div>;})}</Crd>}
</div></div>;
}
// ==================== PLAY ====================
function Play({onStart,active,onUpdate,onFinish,T,onToggle,profile}){
const[courseId,setCourseId]=useState("goat_hill");const[tee,setTee]=useState(null);const[cur,setCur]=useState(0);
const[h,setH]=useState({par:4,sc:0,pt:0,cl:"",yd:"",fw:"",gir:false});const[shots,setShots]=useState([]);const[marking,setMarking]=useState(false);const[history,setHistory]=useState([]);
const[searchQ,setSearchQ]=useState("");const[searchResults,setSearchResults]=useState([]);const[searching,setSearching]=useState(false);const[apiCourse,setApiCourse]=useState(null);const[showSearch,setShowSearch]=useState(false);
const searchTimer=useRef(null);
const gps=useGPS();const course=active?(apiCourse&&active.course_id===apiCourse.id?apiCourse:getCourse(active.course_id||active.courseId)):(apiCourse||getCourse(courseId));
const defaultTee=Object.keys(course.tees)[Math.min(1,Object.keys(course.tees).length-1)];const selTee=tee||defaultTee;
useEffect(()=>{setTee(null);},[courseId]);
useEffect(()=>{if(active&&!gps.on)gps.start();if(!active&&gps.on)gps.stop();},[active?active.id:null]);
useEffect(()=>{if(active&&cur<active.holes.length)setShots(active.holes[cur].shots||[]);else setShots([]);},[cur,active?active.id:null]);
useEffect(()=>{if(active&&active.holes.length>0)setCur(active.holes.length);else if(active)setCur(0);},[active?active.id:null]);
useEffect(()=>{if(active&&cur<active.holes.length){const x=active.holes[cur];setH({par:x.par,sc:x.sc,pt:x.pt,cl:x.cl||"",yd:x.yd||"",fw:x.fw||"",gir:x.gir||false});}else if(active){setH({par:course.pars[cur]||4,sc:0,pt:0,cl:"",yd:"",fw:"",gir:false});setHistory([]);}},[cur,active?active.id:null]);
const pushUndo=()=>setHistory(p=>[...p,{...h}]);const undo=()=>{if(!history.length)return;setH(history[history.length-1]);setHistory(p=>p.slice(0,-1));};
const teeColors={black:"#e4e4e7",blue:"#60a5fa",white:"#a1a1aa",green:"#34d399",gold:"#fbbf24",silver:"#a8a29e",copper:"#b87333"};
if(!active){const td=course.tees[selTee];const ty=td.y.reduce((s,y)=>s+y,0);
const doSearch=(q)=>{setSearchQ(q);if(searchTimer.current)clearTimeout(searchTimer.current);if(q.length<2){setSearchResults([]);return;}searchTimer.current=setTimeout(async()=>{setSearching(true);const r=await searchCourses(q);setSearchResults(r);setSearching(false);},400);};
const selectApiCourse=(c)=>{setApiCourse(c);setCourseId(c.id);setSearchQ("");setSearchResults([]);setShowSearch(false);setTee(null);};
const selectBuiltIn=(id)=>{setApiCourse(null);setCourseId(id);setTee(null);setShowSearch(false);};
// Course images removed - using clean list design
return <div><Hdr title="New Round" sub="Select course and tees" T={T} onToggleTheme={onToggle} profile={profile}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>
<Crd T={T} style={{marginBottom:10}}>
<Lbl T={T}>Course</Lbl>
{!showSearch?<div style={{display:"flex",flexDirection:"column",gap:6}}>
{apiCourse&&<button onClick={()=>selectApiCourse(apiCourse)} style={{width:"100%",padding:"14px 16px",borderRadius:10,cursor:"pointer",background:T.gd,border:"1px solid "+T.gb,textAlign:"left",display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontSize:14,fontWeight:700,color:T.g,fontFamily:F}}>{apiCourse.name}</div><div style={{fontSize:11,color:T.td,fontFamily:F,marginTop:2}}>{apiCourse.loc+" \u00b7 Par "+apiCourse.par}</div></div><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke={T.g} strokeWidth="2.5" strokeLinecap="round"><path d="M5 12l5 5L20 7"/></svg></button>}
{COURSES.map((c,ci)=>{const a=!apiCourse&&courseId===c.id;return <button key={c.id} onClick={()=>selectBuiltIn(c.id)} style={{width:"100%",padding:"14px 16px",borderRadius:10,cursor:"pointer",background:a?T.gd:"rgba(128,128,128,0.02)",border:a?"1px solid "+T.gb:"1px solid "+T.bdr,textAlign:"left",display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontSize:14,fontWeight:700,color:a?T.g:T.tx,fontFamily:F}}>{c.name}</div><div style={{fontSize:11,color:T.td,fontFamily:F,marginTop:2}}>{c.loc+" \u00b7 Par "+c.par}</div></div>{a&&<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke={T.g} strokeWidth="2.5" strokeLinecap="round"><path d="M5 12l5 5L20 7"/></svg>}</button>;})}
<button onClick={()=>setShowSearch(true)} style={{padding:"14px",borderRadius:12,cursor:"pointer",background:"rgba(128,128,128,0.02)",border:"1px dashed "+T.gb,color:T.g,fontFamily:F,fontSize:13,fontWeight:600,textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
Search 30,000+ Courses</button>
</div>
:<div>
<div style={{display:"flex",gap:6,marginBottom:8}}><input type="text" value={searchQ} onChange={e=>doSearch(e.target.value)} placeholder="Search course name..." autoFocus style={{flex:1,background:"rgba(128,128,128,0.04)",border:"1px solid "+T.gb,borderRadius:8,padding:"11px 14px",color:T.tx,fontSize:14,fontFamily:F,outline:"none",boxSizing:"border-box"}}/><button onClick={()=>{setShowSearch(false);setSearchQ("");setSearchResults([]);}} style={{padding:"10px 14px",borderRadius:8,background:T.rd,border:"none",color:T.r,fontSize:12,fontWeight:700,cursor:"pointer",fontFamily:F}}>Cancel</button></div>
{searching&&<div style={{textAlign:"center",padding:"16px 0"}}><Spinner T={T} size={18}/><div style={{fontSize:11,color:T.td,fontFamily:F,marginTop:6}}>Searching courses...</div></div>}
{!searching&&searchQ.length>=2&&searchResults.length===0&&<div style={{textAlign:"center",padding:"16px 0",color:T.td,fontSize:12,fontFamily:F}}>No courses found for "{searchQ}"</div>}
{searchResults.map(c=><button key={c.id} onClick={()=>selectApiCourse(c)} style={{width:"100%",padding:"12px 14px",borderRadius:10,cursor:"pointer",background:"rgba(128,128,128,0.02)",border:"1px solid "+T.bdr,color:T.td,fontFamily:F,textAlign:"left",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}><div><div style={{fontSize:13,fontWeight:700,color:T.tx}}>{c.name}</div><div style={{fontSize:11,fontWeight:400,marginTop:2}}>{c.loc}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:12,fontWeight:600,fontFamily:M,opacity:0.5}}>Par {c.par}</div><div style={{fontSize:10,color:T.td,fontFamily:F}}>{Object.keys(c.tees).length} tees</div></div></button>)}
</div>}
</Crd>
<Crd T={T} style={{marginBottom:10}}><Lbl T={T}>Tees</Lbl><div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{Object.entries(course.tees).map(([t,d])=>{const a=selTee===t;const tc=teeColors[t]||T.g;return <button key={t} onClick={()=>setTee(t)} style={{flex:1,minWidth:60,padding:"11px 6px",borderRadius:8,background:a?"rgba(128,128,128,0.08)":"rgba(128,128,128,0.02)",border:a?"1px solid "+tc+"33":"1px solid "+T.bdr,color:a?tc:T.td,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:F,textTransform:"capitalize"}}><div>{t}</div><div style={{fontSize:11,fontWeight:400,marginTop:2,fontFamily:M,opacity:0.6}}>{d.y.reduce((s,y)=>s+y,0)}</div></button>;})}</div>
<div style={{display:"flex",justifyContent:"center",gap:20,marginTop:12,padding:"10px 0 2px",borderTop:"1px solid "+T.bdr}}><St label="Rating" value={td.r} small T={T}/><St label="Slope" value={td.s} small T={T}/><St label="Yards" value={ty} small T={T}/></div></Crd>
<Btn T={T} onClick={()=>onStart({id:genId(),course_name:course.name,course_id:course.id,cr:td.r,sr:td.s,tee:selTee,date:new Date().toISOString(),holes:[]})}>Start Round</Btn>
</div></div>;}
const cid=active.course_id||active.courseId;const ed=cur<active.holes.length,hn=cur+1;
const ts=active.holes.reduce((s,x)=>s+(x.sc||0),0),tp=active.holes.reduce((s,x)=>s+(x.par||0),0);
const teeKey=active.tee||Object.keys(course.tees)[0];const teeD=course.tees[teeKey];const ty=teeD?teeD.y:course.pars.map(()=>0),hy=ty[cur]||0,hp=course.pars[cur]||4,ht=course.tips?course.tips[cur]:null;
const svHole=()=>{const d={hole:hn,par:h.par||hp,sc:h.sc||(h.par||hp),pt:h.pt,cl:h.cl,yd:h.yd?parseInt(h.yd):hy,fw:h.fw,gir:h.gir,shots:shots};const nh=[...active.holes];if(ed)nh[cur]=d;else nh.push(d);onUpdate({...active,holes:nh});if(!ed&&hn<18){setCur(cur+1);setH({par:4,sc:0,pt:0,cl:"",yd:"",fw:"",gir:false});setShots([]);setHistory([]);}else if(ed)setCur(active.holes.length);};
const diffStr=ts-tp>0?"+":"";const diffVal=ts-tp===0?"E":ts-tp;
return <div>
<Hdr title={"Hole "+hn} sub={course.name+" \u00b7 Thru "+active.holes.length+" \u00b7 "+diffStr+diffVal+" ("+ts+")"} T={T} onToggleTheme={onToggle} profile={profile} right={<Btn v="danger" T={T} onClick={onFinish} style={{width:"auto",padding:"7px 14px",fontSize:11}}>End</Btn>}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>
<div style={{display:"flex",gap:2,marginBottom:12,overflowX:"auto",scrollbarWidth:"none"}}>{Array.from({length:18},(_,i)=>{const x=active.holes[i],a=i===cur;let bg="rgba(128,128,128,0.05)",cl=T.td;if(a){bg=T.g;cl=T.bg;}else if(x){const d=x.sc-x.par;if(d<0){bg=T.gd;cl=T.g;}else if(d===0){bg=T.bd;cl=T.b;}else{bg=T.od;cl=T.o;}}return <button key={i} onClick={()=>setCur(i)} style={{minWidth:28,height:28,borderRadius:6,background:bg,color:cl,border:"none",fontSize:10,fontWeight:700,cursor:"pointer",fontFamily:M,flexShrink:0}}>{i+1}</button>;})}</div>
<div style={{display:"flex",justifyContent:"center",gap:18,marginBottom:10,padding:"10px 0",background:T.card,borderRadius:10,border:"1px solid "+T.bdr}}><St label="Par" value={hp} small T={T}/><St label="Yards" value={hy} small T={T}/>{gps.pos&&course.greens&&course.greens[cur]&&!course.apiCourse&&<St label="To Green" value={gpsDist(gps.pos.lat,gps.pos.lng,course.greens[cur].lat,course.greens[cur].lng)} color={T.g} small T={T}/>}</div>
{!course.apiCourse&&<ShotMap shots={shots} holeIdx={cur} courseId={cid} theme={T} livePos={gps.pos} teeCoords={course.teeBoxes?course.teeBoxes[cur]:null}/>}
<Crd T={T} style={{marginBottom:10,border:"1px solid "+T.gb}}>
<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><div style={{fontSize:10,color:T.g,textTransform:"uppercase",letterSpacing:"0.1em",fontFamily:F,fontWeight:700}}>GPS</div>{gps.pos&&<div style={{fontSize:10,color:T.td,fontFamily:M}}>{"±"+Math.round(gps.pos.acc)+"m"}</div>}</div>
{!gps.pos&&!gps.err&&<div style={{textAlign:"center",padding:"8px 0",color:T.td,fontSize:12,fontFamily:F}}>Acquiring signal...</div>}
{gps.err&&<div style={{textAlign:"center",padding:"8px 0",color:T.o,fontSize:12,fontFamily:F}}>Enable location services</div>}
<button disabled={marking||!gps.pos} onClick={async()=>{setMarking(true);try{const p=await gps.once();const s={lat:p.lat,lng:p.lng,acc:p.acc,ts:Date.now()};if(shots.length>0){const pr=shots[shots.length-1];s.dist=gpsDist(pr.lat,pr.lng,p.lat,p.lng);}if(course.greens&&course.greens[cur]&&!course.apiCourse)s.toGreen=gpsDist(p.lat,p.lng,course.greens[cur].lat,course.greens[cur].lng);setShots(prev=>[...prev,s]);}catch(e){console.error(e);}setMarking(false);}} style={{width:"100%",padding:"11px",borderRadius:8,background:T.gd,border:"1px solid "+T.gb,color:T.g,fontSize:12,fontWeight:700,cursor:!gps.pos?"not-allowed":"pointer",fontFamily:F,opacity:!gps.pos?0.4:1}}>{marking?"Marking...":"Mark Shot "+(shots.length+1)}</button>
{shots.length>0&&<div style={{marginTop:8}}>{shots.map((s,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"7px 0",borderTop:i>0?"1px solid "+T.bdr:"none"}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:20,height:20,borderRadius:5,background:T.gd,color:T.g,fontSize:10,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:M}}>{i+1}</div><div><div style={{fontSize:12,color:T.tx,fontWeight:600,fontFamily:F}}>{"Shot "+(i+1)}{s.dist&&<span style={{color:T.g,fontFamily:M,marginLeft:6,fontSize:11}}>{s.dist+" yd"}</span>}</div><div style={{fontSize:10,color:T.td,fontFamily:F}}>{s.toGreen?s.toGreen+" yd to green":"\u00b1"+Math.round(s.acc)+"m acc"}</div></div></div><button onClick={()=>setShots(p=>p.filter((_,j)=>j!==i))} style={{background:"none",border:"none",color:T.td,fontSize:13,cursor:"pointer",padding:4}}>{"\u00d7"}</button></div>)}</div>}
</Crd>
{ht&&<div style={{background:"rgba(128,128,128,0.03)",borderRadius:8,padding:"10px 12px",marginBottom:10,borderLeft:"2px solid "+T.gb}}><div style={{fontSize:11,color:T.tm,fontFamily:F,lineHeight:1.6}}>{ht}</div></div>}
<Crd T={T} style={{marginBottom:10}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}><Lbl T={T}>Score</Lbl>{history.length>0&&<button onClick={undo} style={{background:T.gd,border:"1px solid "+T.gb,borderRadius:6,padding:"3px 10px",color:T.g,fontSize:10,fontWeight:700,fontFamily:F,cursor:"pointer"}}>Undo</button>}</div><div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:22,marginBottom:4}}><button onClick={()=>{pushUndo();setH(s=>({...s,sc:Math.max(1,(s.sc||s.par)-1)}));}} style={{width:44,height:44,borderRadius:10,background:"rgba(128,128,128,0.06)",border:"1px solid "+T.bdr,color:T.tx,fontSize:20,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>{"\u2212"}</button><div style={{fontSize:42,fontWeight:700,color:T.tx,fontFamily:M,minWidth:52,textAlign:"center"}}>{h.sc||h.par}</div><button onClick={()=>{pushUndo();setH(s=>({...s,sc:(s.sc||s.par)+1}));}} style={{width:44,height:44,borderRadius:10,background:"rgba(128,128,128,0.06)",border:"1px solid "+T.bdr,color:T.tx,fontSize:20,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>+</button></div><div style={{textAlign:"center"}}><ScLbl sc={h.sc||h.par} par={h.par} T={T}/></div></Crd>
<Crd T={T} style={{marginBottom:10}}><Lbl T={T}>Putts</Lbl><div style={{display:"flex",gap:5}}>{[0,1,2,3,4].map(p=><Pill key={p} active={h.pt===p} T={T} onClick={()=>{pushUndo();setH(s=>({...s,pt:p}));}}>{p}</Pill>)}</div></Crd>
<Crd T={T} style={{marginBottom:10}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><div><Lbl T={T}>Club</Lbl><select value={h.cl} onChange={e=>{pushUndo();setH(s=>({...s,cl:e.target.value}));}} style={{width:"100%",background:"rgba(128,128,128,0.04)",border:"1px solid "+T.bdr,borderRadius:8,padding:"9px 12px",color:T.tx,fontSize:14,fontFamily:F,outline:"none"}}><option value="">Select</option>{CLUBS.map(c=><option key={c} value={c}>{c}</option>)}</select></div><div><Lbl T={T}>Yardage</Lbl><input type="number" inputMode="numeric" value={h.yd} onChange={e=>{pushUndo();setH(s=>({...s,yd:e.target.value}));}} placeholder={""+hy} style={{width:"100%",background:"rgba(128,128,128,0.04)",border:"1px solid "+T.bdr,borderRadius:8,padding:"9px 12px",color:T.tx,fontSize:14,fontFamily:F,outline:"none",boxSizing:"border-box"}}/></div></div></Crd>
{(h.par||hp)>3&&<Crd T={T} style={{marginBottom:10}}><Lbl T={T}>Fairway</Lbl><div style={{display:"flex",gap:6}}>{[{v:"hit",l:"Hit"},{v:"left",l:"Left"},{v:"right",l:"Right"}].map(f=><Pill key={f.v} active={h.fw===f.v} color={f.v==="hit"?T.g:T.o} bg={f.v==="hit"?T.gd:T.od} T={T} onClick={()=>{pushUndo();setH(s=>({...s,fw:s.fw===f.v?"":f.v}));}}>{f.l}</Pill>)}</div></Crd>}
<Crd T={T} style={{marginBottom:10}}><button onClick={()=>{pushUndo();setH(s=>({...s,gir:!s.gir}));}} style={{width:"100%",padding:"10px",borderRadius:8,background:h.gir?T.gd:"transparent",border:"1px solid "+(h.gir?T.gb:T.bdr),color:h.gir?T.g:T.td,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:F}}>{h.gir?"GIR \u2014 Yes":"Green in Regulation"}</button></Crd>
<Btn T={T} onClick={svHole}>{ed?"Update Hole":hn===18?"Save Final Hole":"Save Hole "+hn}</Btn>
{active.holes.length>0&&<Crd T={T} style={{marginTop:10}}><Lbl T={T}>Scorecard</Lbl><Scorecard holes={active.holes} onTap={setCur} T={T}/></Crd>}
</div></div>;
}
// ==================== ROUNDS & BAG ====================
function Rounds({rounds,onDel,T,onToggle,profile}){
if(!rounds.length)return <div><Hdr title="Rounds" sub="History" T={T} onToggleTheme={onToggle} profile={profile}/><div style={{padding:"0 16px"}}>
<Crd T={T} style={{textAlign:"center",padding:"32px 20px"}}>
<div style={{fontSize:32,marginBottom:8,opacity:0.3}}>📋</div>
<div style={{color:T.tx,fontSize:16,fontWeight:700,fontFamily:F}}>No rounds yet</div>
<div style={{color:T.td,fontSize:12,fontFamily:F,marginTop:4}}>Your round history will appear here</div>
</Crd></div></div>;
return <div><Hdr title="Rounds" sub={rounds.length+" recorded"} T={T} onToggleTheme={onToggle} profile={profile}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>{rounds.slice().reverse().map(r=>{const t=r.holes.reduce((s,h)=>s+(h.sc||0),0),p=r.holes.reduce((s,h)=>s+(h.par||0),0),pt=r.holes.reduce((s,h)=>s+(h.pt||0),0);return <Crd key={r.id} T={T} style={{marginBottom:6}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div><div style={{color:T.tx,fontSize:14,fontWeight:600,fontFamily:F}}>{r.course_name||r.courseName}</div><div style={{color:T.td,fontSize:11,fontFamily:F,marginTop:2}}>{new Date(r.date).toLocaleDateString()+" \u00b7 "+r.holes.length+"h"}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:20,fontWeight:700,color:T.tx,fontFamily:M,lineHeight:1}}>{t}</div><Diff d={t-p} style={{fontSize:12}} T={T}/></div></div><div style={{display:"flex",gap:14,marginTop:8,paddingTop:8,borderTop:"1px solid "+T.bdr}}><span style={{fontSize:11,color:T.td,fontFamily:F}}>{pt+" putts"}</span>{r.cr&&<span style={{fontSize:11,color:T.td,fontFamily:F}}>{"CR "+r.cr}</span>}{r.sr&&<span style={{fontSize:11,color:T.td,fontFamily:F}}>{"SR "+r.sr}</span>}<button onClick={()=>onDel(r.id)} style={{marginLeft:"auto",background:"none",border:"none",color:T.td,fontSize:11,cursor:"pointer",fontFamily:F}}>Delete</button></div></Crd>;})}</div></div>;
}
function Bag({rounds,T,onToggle,profile}){
const stats=useMemo(()=>{const s={};rounds.forEach(r=>r.holes.forEach(h=>{if(h.cl&&h.yd){if(!s[h.cl])s[h.cl]={d:[],n:0};s[h.cl].d.push(h.yd);s[h.cl].n++;}}));return Object.entries(s).map(([cl,d])=>({cl:cl,n:d.n,avg:Math.round(d.d.reduce((s,x)=>s+x,0)/d.d.length),max:Math.max(...d.d),min:Math.min(...d.d)})).sort((a,b)=>b.avg-a.avg);},[rounds]);
return <div><Hdr title="My Bag" sub="Club distances" T={T} onToggleTheme={onToggle} profile={profile}/>
<div style={{padding:"0 16px 100px",overflowY:"auto",height:"calc(100vh - 120px)"}}>{!stats.length?<div style={{padding:"0"}}>
<Crd T={T} style={{textAlign:"center",padding:"32px 20px"}}>
<div style={{fontSize:32,marginBottom:8,opacity:0.3}}>🏌️</div>
<div style={{color:T.tx,fontSize:16,fontWeight:700,fontFamily:F}}>Your Bag</div>
<div style={{color:T.td,fontSize:12,fontFamily:F,marginTop:4}}>Track yardage to see club averages</div>
</Crd></div>
:stats.map(s=><Crd key={s.cl} T={T} style={{marginBottom:6}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{color:T.tx,fontSize:14,fontWeight:600,fontFamily:F}}>{s.cl}</div><div style={{color:T.td,fontSize:11,fontFamily:F,marginTop:2}}>{s.n+" shot"+(s.n!==1?"s":"")}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:20,fontWeight:700,color:T.g,fontFamily:M,lineHeight:1}}>{s.avg}<span style={{fontSize:10,fontWeight:400,color:T.td,marginLeft:2}}>yd</span></div><div style={{fontSize:10,color:T.td,fontFamily:M,marginTop:2}}>{s.min+"\u2013"+s.max}</div></div></div><div style={{marginTop:8,height:3,background:"rgba(128,128,128,0.06)",borderRadius:2,overflow:"hidden"}}><div style={{height:"100%",borderRadius:2,background:"linear-gradient(90deg,"+T.g+"66,"+T.g+")",width:Math.min(100,s.avg/300*100)+"%",transition:"width 0.4s"}}/></div></Crd>)}</div></div>;
}

// ==================== MAIN APP ====================
function App(){
const[user,setUser]=useState(null);
const[profile,setProfile]=useState(null);
const[rounds,setRounds]=useState([]);
const[active,setActive]=useState(null);
const[tab,setTab]=useState("dashboard");
const[loading,setLoading]=useState(true);
const[isDark,setIsDark]=useState(true);
const T=isDark?dark:light;const toggle=()=>setIsDark(p=>!p);

// Check auth on mount
useEffect(()=>{
let sub=null;
const init=async()=>{
try{
const timeout=new Promise((_,rej)=>setTimeout(()=>rej("timeout"),5000));
const check=sb.auth.getSession();
const result=await Promise.race([check,timeout]);
if(result?.data?.session?.user){
setUser(result.data.session.user);
try{await Promise.race([loadProfile(result.data.session.user.id),new Promise((_,r)=>setTimeout(()=>r("profile timeout"),4000))]);}catch(e2){}
try{await Promise.race([loadRounds(result.data.session.user.id),new Promise((_,r)=>setTimeout(()=>r("rounds timeout"),4000))]);}catch(e3){}
}
}catch(e){console.log("Auth init:",e);}
console.log("Auth init complete, showing app");
setLoading(false);
};
init();
try{
const{data:{subscription}}=sb.auth.onAuthStateChange(async(event,session)=>{
if(event==="SIGNED_IN"&&session?.user){
setUser(session.user);
try{await loadProfile(session.user.id);}catch(e){}
try{await loadRounds(session.user.id);}catch(e){}
}else if(event==="SIGNED_OUT"){
setUser(null);setProfile(null);setRounds([]);setActive(null);
}
});
sub=subscription;
}catch(e){console.log("Auth listener error:",e);}
return()=>{try{if(sub)sub.unsubscribe();}catch(e){}};
},[]);

const loadProfile=async(uid)=>{
const{data}=await sb.from("profiles").select("*").eq("id",uid).single();
if(data)setProfile(data);
};
const loadRounds=async(uid)=>{
const{data}=await sb.from("rounds").select("*").eq("user_id",uid).order("date",{ascending:false});
if(data)setRounds(data);
};

const handleAuth=async(u)=>{
setUser(u);
await loadProfile(u.id);
await loadRounds(u.id);
};
const handleLogout=async()=>{
await sb.auth.signOut();
setUser(null);setProfile(null);setRounds([]);setActive(null);setTab("dashboard");
};
const updateProfile=(p)=>setProfile(p);

const startRound=useCallback(r=>{setActive(r);setTab("play");},[]);
const updateRound=useCallback(r=>setActive(r),[]);
const finishRound=useCallback(async()=>{
if(active&&active.holes.length>0&&user){
const ts=active.holes.reduce((s,h)=>s+(h.sc||0),0);
const tp=active.holes.reduce((s,h)=>s+(h.pt||0),0);
const{data,error}=await sb.from("rounds").insert({
user_id:user.id,course_id:active.course_id,course_name:active.course_name,
tee:active.tee,cr:active.cr,sr:active.sr,date:active.date,
holes:active.holes,total_score:ts,total_putts:tp
}).select().single();
if(data)setRounds(p=>[data,...p]);
}
setActive(null);setTab("dashboard");
},[active,user]);

const deleteRound=useCallback(async(id)=>{
await sb.from("rounds").delete().eq("id",id);
setRounds(p=>p.filter(r=>r.id!==id));
},[]);

if(loading)return <div style={{minHeight:"100vh",background:"#050507",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:20}}><LOGO/><Spinner T={dark} size={24}/></div>;
if(!user)return <AuthScreen onAuth={handleAuth} T={T}/>;
if(!profile)return <div style={{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center"}}><Spinner T={T} size={32}/></div>;

return <div style={{minHeight:"100vh",maxHeight:"100vh",overflow:"hidden",background:T.bg,fontFamily:F,maxWidth:480,margin:"0 auto",position:"relative",transition:"background 0.3s"}}>
{tab==="dashboard"&&<Dashboard rounds={rounds} T={T} onToggle={toggle} profile={profile}/>}
{tab==="play"&&<Play active={active} onStart={startRound} onUpdate={updateRound} onFinish={finishRound} T={T} onToggle={toggle} profile={profile}/>}
{tab==="rounds"&&<Rounds rounds={rounds} onDel={deleteRound} T={T} onToggle={toggle} profile={profile}/>}
{tab==="bag"&&<Bag rounds={rounds} T={T} onToggle={toggle} profile={profile}/>}
{tab==="profile"&&<ProfileScreen profile={profile} rounds={rounds} onUpdateProfile={updateProfile} onLogout={handleLogout} T={T} onToggle={toggle}/>}
<TabBar active={tab} onChange={setTab} T={T}/>
</div>;
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(()=>{});}</script>
</body>
</html>
